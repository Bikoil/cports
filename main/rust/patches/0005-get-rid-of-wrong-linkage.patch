From a6719f36bd10b6704dd8b1c46c9e3f1685bb2a28 Mon Sep 17 00:00:00 2001
From: q66 <q66@chimera-linux.org>
Date: Mon, 9 Sep 2024 17:53:26 +0200
Subject: [PATCH 05/14] get rid of wrong linkage

There is no good way to compute the clang builtins library
path from inside the rust code, but there should be no harm
in just disabling nodefaultlibs for our platform.
---
 vendor/libc-0.2.107/src/unix/mod.rs | 7 +------
 vendor/libc-0.2.112/src/unix/mod.rs | 7 +------
 vendor/libc-0.2.119/src/unix/mod.rs | 7 +------
 vendor/libc-0.2.121/src/unix/mod.rs | 7 +------
 vendor/libc-0.2.124/src/unix/mod.rs | 7 +------
 vendor/libc-0.2.150/src/unix/mod.rs | 7 +------
 vendor/libc-0.2.155/src/unix/mod.rs | 7 +------
 vendor/libc-0.2.157/src/unix/mod.rs | 7 +------
 vendor/libc-0.2.158/src/unix/mod.rs | 7 +------
 vendor/libc-0.2.94/src/unix/mod.rs  | 7 +------
 vendor/libc-0.2.97/src/unix/mod.rs  | 7 +------
 11 files changed, 11 insertions(+), 66 deletions(-)

diff --git a/vendor/libc-0.2.107/src/unix/mod.rs b/vendor/libc-0.2.107/src/unix/mod.rs
index 52f875218..51837c6b1 100644
--- a/vendor/libc-0.2.107/src/unix/mod.rs
+++ b/vendor/libc-0.2.107/src/unix/mod.rs
@@ -329,12 +329,7 @@ cfg_if! {
         #[link(name = "c", cfg(not(target_feature = "crt-static")))]
         extern {}
     } else if #[cfg(target_env = "musl")] {
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", kind = "static", modifiers = "-bundle",
-                        cfg(target_feature = "crt-static")))]
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", cfg(not(target_feature = "crt-static"))))]
-        extern {}
+        // we don't set -nodefaultlibs, so no need to link anything
     } else if #[cfg(target_os = "emscripten")] {
         #[link(name = "c")]
         extern {}
diff --git a/vendor/libc-0.2.112/src/unix/mod.rs b/vendor/libc-0.2.112/src/unix/mod.rs
index 5ff2294e7..ca4bf46c9 100644
--- a/vendor/libc-0.2.112/src/unix/mod.rs
+++ b/vendor/libc-0.2.112/src/unix/mod.rs
@@ -329,12 +329,7 @@ cfg_if! {
         #[link(name = "c", cfg(not(target_feature = "crt-static")))]
         extern {}
     } else if #[cfg(target_env = "musl")] {
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", kind = "static", modifiers = "-bundle",
-                        cfg(target_feature = "crt-static")))]
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", cfg(not(target_feature = "crt-static"))))]
-        extern {}
+        // we don't set -nodefaultlibs, so no need to link anything
     } else if #[cfg(target_os = "emscripten")] {
         #[link(name = "c")]
         extern {}
diff --git a/vendor/libc-0.2.119/src/unix/mod.rs b/vendor/libc-0.2.119/src/unix/mod.rs
index 5ff2294e7..ca4bf46c9 100644
--- a/vendor/libc-0.2.119/src/unix/mod.rs
+++ b/vendor/libc-0.2.119/src/unix/mod.rs
@@ -329,12 +329,7 @@ cfg_if! {
         #[link(name = "c", cfg(not(target_feature = "crt-static")))]
         extern {}
     } else if #[cfg(target_env = "musl")] {
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", kind = "static", modifiers = "-bundle",
-                        cfg(target_feature = "crt-static")))]
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", cfg(not(target_feature = "crt-static"))))]
-        extern {}
+        // we don't set -nodefaultlibs, so no need to link anything
     } else if #[cfg(target_os = "emscripten")] {
         #[link(name = "c")]
         extern {}
diff --git a/vendor/libc-0.2.121/src/unix/mod.rs b/vendor/libc-0.2.121/src/unix/mod.rs
index cb03b50d7..bf4d21a0b 100644
--- a/vendor/libc-0.2.121/src/unix/mod.rs
+++ b/vendor/libc-0.2.121/src/unix/mod.rs
@@ -337,12 +337,7 @@ cfg_if! {
         #[link(name = "c", cfg(not(target_feature = "crt-static")))]
         extern {}
     } else if #[cfg(target_env = "musl")] {
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", kind = "static", modifiers = "-bundle",
-                        cfg(target_feature = "crt-static")))]
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", cfg(not(target_feature = "crt-static"))))]
-        extern {}
+        // we don't set -nodefaultlibs, so no need to link anything
     } else if #[cfg(target_os = "emscripten")] {
         #[link(name = "c")]
         extern {}
diff --git a/vendor/libc-0.2.124/src/unix/mod.rs b/vendor/libc-0.2.124/src/unix/mod.rs
index cb03b50d7..bf4d21a0b 100644
--- a/vendor/libc-0.2.124/src/unix/mod.rs
+++ b/vendor/libc-0.2.124/src/unix/mod.rs
@@ -337,12 +337,7 @@ cfg_if! {
         #[link(name = "c", cfg(not(target_feature = "crt-static")))]
         extern {}
     } else if #[cfg(target_env = "musl")] {
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", kind = "static", modifiers = "-bundle",
-                        cfg(target_feature = "crt-static")))]
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", cfg(not(target_feature = "crt-static"))))]
-        extern {}
+        // we don't set -nodefaultlibs, so no need to link anything
     } else if #[cfg(target_os = "emscripten")] {
         #[link(name = "c")]
         extern {}
diff --git a/vendor/libc-0.2.150/src/unix/mod.rs b/vendor/libc-0.2.150/src/unix/mod.rs
index 9daebcaa6..549877b53 100644
--- a/vendor/libc-0.2.150/src/unix/mod.rs
+++ b/vendor/libc-0.2.150/src/unix/mod.rs
@@ -352,12 +352,7 @@ cfg_if! {
         #[link(name = "c", cfg(not(target_feature = "crt-static")))]
         extern {}
     } else if #[cfg(any(target_env = "musl", target_env = "ohos"))] {
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", kind = "static", modifiers = "-bundle",
-                        cfg(target_feature = "crt-static")))]
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", cfg(not(target_feature = "crt-static"))))]
-        extern {}
+        // we don't set -nodefaultlibs, so no need to link anything
     } else if #[cfg(target_os = "emscripten")] {
         #[link(name = "c")]
         extern {}
diff --git a/vendor/libc-0.2.155/src/unix/mod.rs b/vendor/libc-0.2.155/src/unix/mod.rs
index 49984d3f0..76890a787 100644
--- a/vendor/libc-0.2.155/src/unix/mod.rs
+++ b/vendor/libc-0.2.155/src/unix/mod.rs
@@ -348,12 +348,7 @@ cfg_if! {
         #[link(name = "c", cfg(not(target_feature = "crt-static")))]
         extern {}
     } else if #[cfg(any(target_env = "musl", target_env = "ohos"))] {
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", kind = "static", modifiers = "-bundle",
-                        cfg(target_feature = "crt-static")))]
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", cfg(not(target_feature = "crt-static"))))]
-        extern {}
+        // we don't set -nodefaultlibs, so no need to link anything
     } else if #[cfg(target_os = "emscripten")] {
         #[link(name = "c")]
         extern {}
diff --git a/vendor/libc-0.2.157/src/unix/mod.rs b/vendor/libc-0.2.157/src/unix/mod.rs
index 8b3d988ae..5ac630248 100644
--- a/vendor/libc-0.2.157/src/unix/mod.rs
+++ b/vendor/libc-0.2.157/src/unix/mod.rs
@@ -348,12 +348,7 @@ cfg_if! {
         #[link(name = "c", cfg(not(target_feature = "crt-static")))]
         extern {}
     } else if #[cfg(any(target_env = "musl", target_env = "ohos"))] {
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", kind = "static", modifiers = "-bundle",
-                        cfg(target_feature = "crt-static")))]
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", cfg(not(target_feature = "crt-static"))))]
-        extern {}
+        // we don't set -nodefaultlibs, so no need to link anything
     } else if #[cfg(target_os = "emscripten")] {
         #[link(name = "c")]
         extern {}
diff --git a/vendor/libc-0.2.158/src/unix/mod.rs b/vendor/libc-0.2.158/src/unix/mod.rs
index 8b3d988ae..5ac630248 100644
--- a/vendor/libc-0.2.158/src/unix/mod.rs
+++ b/vendor/libc-0.2.158/src/unix/mod.rs
@@ -348,12 +348,7 @@ cfg_if! {
         #[link(name = "c", cfg(not(target_feature = "crt-static")))]
         extern {}
     } else if #[cfg(any(target_env = "musl", target_env = "ohos"))] {
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", kind = "static", modifiers = "-bundle",
-                        cfg(target_feature = "crt-static")))]
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", cfg(not(target_feature = "crt-static"))))]
-        extern {}
+        // we don't set -nodefaultlibs, so no need to link anything
     } else if #[cfg(target_os = "emscripten")] {
         #[link(name = "c")]
         extern {}
diff --git a/vendor/libc-0.2.94/src/unix/mod.rs b/vendor/libc-0.2.94/src/unix/mod.rs
index be7b6e73e..5131bdb7c 100644
--- a/vendor/libc-0.2.94/src/unix/mod.rs
+++ b/vendor/libc-0.2.94/src/unix/mod.rs
@@ -329,12 +329,7 @@ cfg_if! {
         #[link(name = "c", cfg(not(target_feature = "crt-static")))]
         extern {}
     } else if #[cfg(target_env = "musl")] {
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", kind = "static",
-                        cfg(target_feature = "crt-static")))]
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", cfg(not(target_feature = "crt-static"))))]
-        extern {}
+        // we don't set -nodefaultlibs, so no need to link anything
     } else if #[cfg(target_os = "emscripten")] {
         #[link(name = "c")]
         extern {}
diff --git a/vendor/libc-0.2.97/src/unix/mod.rs b/vendor/libc-0.2.97/src/unix/mod.rs
index be7b6e73e..5131bdb7c 100644
--- a/vendor/libc-0.2.97/src/unix/mod.rs
+++ b/vendor/libc-0.2.97/src/unix/mod.rs
@@ -329,12 +329,7 @@ cfg_if! {
         #[link(name = "c", cfg(not(target_feature = "crt-static")))]
         extern {}
     } else if #[cfg(target_env = "musl")] {
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", kind = "static",
-                        cfg(target_feature = "crt-static")))]
-        #[cfg_attr(feature = "rustc-dep-of-std",
-                   link(name = "c", cfg(not(target_feature = "crt-static"))))]
-        extern {}
+        // we don't set -nodefaultlibs, so no need to link anything
     } else if #[cfg(target_os = "emscripten")] {
         #[link(name = "c")]
         extern {}
-- 
2.47.0

